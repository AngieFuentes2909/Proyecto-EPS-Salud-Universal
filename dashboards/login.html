<!DOCTYPE html>
<html lang="es">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Login EPS Universal</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet" />
        <style>
            body {
                background: #f1f5f9;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: 'Inter', sans-serif;
            }

            .login-card {
                background: white;
                border-radius: 1rem;
                padding: 2.5rem;
                width: 100%;
                max-width: 420px;
                box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.1);
                border-top: 4px solid #facc15;
            }

            .login-card h2 {
                font-weight: 700;
                color: #1e293b;
            }

            .btn-custom {
                background-color: #facc15;
                color: #1e293b;
                font-weight: 600;
                border: none;
            }

            .btn-custom:hover {
                background-color: #eab308;
            }

            .form-control:focus {
                border-color: #facc15;
                box-shadow: 0 0 0 0.2rem rgba(250, 204, 21, 0.25);
            }

            .error-msg {
                color: #dc3545;
                font-size: 0.9rem;
                margin-top: 0.3rem;
            }

            .success-msg {
                color: #198754;
                font-size: 1rem;
                margin-top: 1rem;
                text-align: center;
            }

            .login-icon {
                font-size: 3rem;
                color: #facc15;
                margin-bottom: 1rem;
            }
        </style>
    </head>

    <body>
        <main class="login-card">
            <div class="text-center">
                <i class="bi bi-shield-lock login-icon"></i>
                <h2 class="mb-4">EPS Universal<br><br>Iniciar Sesión</h2>
            </div>
            <form id="loginForm" novalidate>
                <div class="mb-3">
                    <label for="document" class="form-label">Usuario</label>
                    <input type="text" class="form-control" id="document" placeholder="Ingrese su número de documento" required pattern="^\d{3,15}$" />
                    <div class="error-msg" id="docError"></div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Contraseña</label>
                    <input type="password" class="form-control" id="password" placeholder="Ingrese su contraseña" required minlength="6" />
                    <div class="error-msg" id="passError"></div>
                </div>
                <button type="submit" class="btn btn-custom w-100">Entrar</button>
            </form>
            <div id="loginResult" class="success-msg"></div>
        </main>

        <script>
            const loginForm = document.getElementById("loginForm");
            const usuarioInput = document.getElementById("document");
            const passInput = document.getElementById("password");
            const docError = document.getElementById("docError");
            const passError = document.getElementById("passError");
            const loginResult = document.getElementById("loginResult");

            loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
                    docError.textContent = "";
                    passError.textContent = "";
                    loginResult.textContent = "";
                    const usuario = usuarioInput.value.trim();
                    const contrasena = passInput.value.trim();
                    if (!usuario) {
            docError.textContent = "El campo usuario no puede estar vacío";
                    return;
            }

            if (!contrasena) {
            passError.textContent = "La contraseña no puede estar vacía";
                    return;
            }

            try {
            const response = await fetch("../App/authenticate.php", {
            method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({usuario, contrasena}),
            });
                    const data = await response.json();
                    console.log("Respuesta del servidor:", data);
                    if (data.success) {
            loginResult.style.color = "#198754";
                    if (data.rol === "administrador") {
            loginResult.textContent = "✅ Bienvenido administrador. Redirigiendo...";
                    setTimeout(() => {
                    window.location.href = "/Proyecto-EPS-Salud-Universal/dashboards/dashboard-administardor.html";
                    }, 2000);
            } else if (data.rol === "doctor") {
            loginResult.textContent = "✅ Bienvenido doctor. Redirigiendo...";
                    setTimeout(() => {
                    window.location.href = "/Proyecto-EPS-Salud-Universal/dashboards/dashboard-doctor.html";
                    }, 2000);
            } else {
            loginResult.style.color = "#dc3545";
                    loginResult.textContent = "❌ Acceso no autorizado para este usuario.";
            }
            } else {
            loginResult.style.color = "#dc3545";
                    loginResult.textContent = "❌ Credenciales incorrectas.";
            }
            } catch (error) {
            loginResult.style.color = "#dc3545";
                    loginResult.textContent = "❌ Error al iniciar sesión. Intente más tarde.";
                    console.error("Error en la petición:", error);
                    }

    });
        </script>



    </body>

</html>